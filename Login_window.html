<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>login</title>
    <link rel="icon" href="amul_logo.png">
    <link rel="stylesheet" href="login_window.css">
    <script src="https://www.gstatic.com/firebasejs/ui/6.0.1/firebase-ui-auth.js"></script>
    <script src="login_window.js"></script>
    <script>
        function redirectToCustomer(){
        document.getElementById("btn1").style.display = "none";
        document.getElementById("btn2").style.display = "none";
        document.getElementById("no_account").style.display = "none";
        document.getElementById("no_account").style.display = "none";
        document.getElementById("field_customer").style.display = "block";
      }
      function redirectToCanteenOwner(){
          document.getElementById("btn1").style.display = "none";
          document.getElementById("btn2").style.display = "none";
          document.getElementById("no_account").style.display = "none";
          document.getElementById("no_account").style.display = "none";
          document.getElementById("field_owner").style.display = "block";
      }
    </script>
    <link type="text/css" rel="stylesheet" href="https://www.gstatic.com/firebasejs/ui/6.0.1/firebase-ui-auth.css" />
</head>
<body>
    <nav>
        <h1 style="margin-left: 60px; font-size: 40px;margin-top: 25px;font-family: cursive;" ></h1>
        <ul>
            <img src="log_mera.jpeg" alt="" height="147px" width="147px" style="float: left; border-radius: 50%; margin-top: -12px; margin-left: -1px;">
           <a href="Login_window.html" id="nav_btn1"  title="Click here to redirect to login page" onmouseover="document.getElementById('drop_down').style.display = 'block';" > <li class="li1"><b> Login/Signup</b></li></a>
           <a href="index.html" id="nav_btn3" title="get back to home page"><li class="li3"><b>Home</b></li></a>
                
        </ul>
    </nav>

    <br><br><br>  
   
       <button type="button" onclick="redirectToCustomer();" style="float: left;font-size: 30px;margin-top: 134px;margin-left: 6cm; border-top: 0px;border-left: 0px;border-right: 0px;border-bottom: 4px orange solid ;
       border-radius: 4%;" id="btn1">Login as a customer</button>
       <button type="button" onclick="redirectToCanteenOwner();" style="font-size: 30px;margin-top: 134px; border-bottom: 4px orange solid ;border-top: 0px;border-left: 0px;border-right: 0px;
       border-radius: 4%;" id="btn2">Login as a Canteen Owner</button>
         
        
       
       
       <fieldset style="background-color: black; width: 400px; display: none;margin: auto; margin-top: 4cm;" id="field_customer">
        <legend style="background-color: orange; border: solid 0.2cm brown; margin-left: 3cm;">Login as a Customer</legend>
    <div style="background-color: gray; width: 400px; padding: 8px; margin-left: 0%; margin-top: 10px;" >
    <form action="" autocomplete="on" style="background-color: gray; width: 400px;" id="contactForm">
    
    
        <label for="email2" style="background: none;">Email :: </label>
        <input type="email" id="email2" style="background-color: white; margin-left: 63px;" > <br> <br>
    
    <label for="Pass2" style="background-color: gray;">Enter password ::</label>
    <input type="password" name="pass" id="Pass2" style="margin-left: 2px; background-color: white;" ><br> <br>

    <button type="submit" value="submit" id="signin_c" title="Click to sign-in">Log in</button>
    </form></div></fieldset>

    



       <fieldset style="background-color: black; width: 400px; display: none;margin: auto; margin-top: 4cm;" id="field_owner">
                <legend style="background-color: orange; border: solid 0.2cm brown; margin-left: 3cm;">Login as a Canteen Owner</legend>
            <div style="background-color: gray; width: 400px; padding: 8px; margin-left: 0%; margin-top: 10px;" >
            <form action="" autocomplete="on" style="background-color: gray; width: 400px;" id="contactForm">
            
            
                <label for="email" style="background: none;">Email :: </label>
                <input type="email" id="email" style="background-color: white; margin-left: 63px;" > <br> <br>
            
            <label for="Pass" style="background-color: gray;">Enter password ::</label>
            <input type="password" name="pass" id="Pass" style="margin-left: 2px; background-color: white;" ><br> <br>
        
            <button type="submit" value="submit" id="signin" title="Click to sign-in">Log in</button>
        </form></div></fieldset>
        
        
       
    


    <fieldset style="background-color: gray; width: 400px; margin-left: 11cm; margin-top: 2cm;border-bottom;border-bottom: 15px orange solid" id="no_account">
   <p style="text-align: center;font-size: 20px;">Don't have an account yet?</p> 
   <a href="sign_up_window.html"> <button type="button" >Sign up</button></a>   
       

</form></div></fieldset>
        <h1 style="font-size: 40px; margin-left: 400px;background-color: aquamarine;color: rgb(21, 160, 28);background: none;display: none;margin-top: 4cm;" id="secretCode">Authenticated successfully</h1>
       <a href="#"> <h1 style="font-size: 20px; margin-top: 7cm;margin-left: 520px;background-color: aquamarine;color: rgb(202, 33, 33);background: none;display: none;text-decoration: underline;" id="update_status" >Update your Canteen Status !</h1>
       </a>

       <a href="canteen_Status.html"> <h1 style="font-size: 20px; margin-top: 6cm;margin-left: 550px;background-color: aquamarine;color: rgb(202, 33, 33);background: one;display: none;text-decoration: underline;" id="view_status" >View Canteen Status</h1>
       </a>
        
<div style="background-color: rgb(206, 159, 159); width: 13cm;margin-left: 11cm;padding: 0.2cm;margin-top: 8cm;display: none;" id="updating_stats">
        <h2 style="margin-left:3.5cm;">Update Canteen Status</h2>
       
        <fieldset style="width: 400px;margin:auto;height: 60px;margin-top: 1cm;">
            <legend style="background-color: rgb(255, 124, 124); color:black; font-size: 15px; padding: 0.7%;">Canteen Name</legend>
            
            <input type="text" name="user_name" id="user_name" style="align-items: center;margin-left: -4px;width: 100%;height: 30px;" required>
        </fieldset>
       
        <fieldset style="width: 400px;margin:auto;height: 60px;margin-top: 1cm;">
            <legend style="background-color: rgb(255, 124, 124); color:black; font-size: 15px; padding: 0.7%;">Email ID of Owner</legend>
            
            <input type="email" name="update_email" id="updating_email" style="align-items: center;margin-left: -4px;width: 100%;height: 30px;" required>
        </fieldset>  



        <fieldset style="width: 200px;height: 60px;margin-top: 1cm;margin-left: 3cm;">
            <legend style="background-color: rgb(255, 124, 124); color:black; font-size: 15px; padding: 0.7%;">Update Status</legend>
        <select name="open/closed" id="new_status" style="margin-left: 0.75cm;margin-top: 0.25cm;" >
            <option value="select" >--select--</option>
            <option value="open">Open</option>
            <option value="closed">Closed</option>
        </select>

        </fieldset>  
        <button type="submit" value="Update" id="update_me" title="Click to sign-in" style="margin-top: 0.5cm;margin-left: 5.5cm;">Update</button>
</div>

<div>
       
</div>

<a href="register_your_canteen.html" style="text-decoration: none;">
<button type="button" id="reg_update" style="text-decoration: none;margin-top: 6cm;" >
    Register your Canteen
    </button> </a>
<button type="button" id="btn_update" style="margin-top: 2cm;">
UPDATE YOUR CANTEEN STATUS
</button>



<script type="module">
            document.getElementById("field_customer").addEventListener('submit',(event)=>{
            event.preventDefault()
           })
           document.getElementById("field_owner").addEventListener('submit',(event)=>{
            event.preventDefault()
           })
            // Import the functions you need from the SDKs you need
            import { initializeApp } from "https://www.gstatic.com/firebasejs/9.17.2/firebase-app.js";
            import { getDatabase, ref, get,set,child, update } from "https://www.gstatic.com/firebasejs/9.17.2/firebase-database.js";
            import { getAuth,
            createUserWithEmailAndPassword,
            signInWithEmailAndPassword,
            onAuthStateChanged,
            signOut} from "https://www.gstatic.com/firebasejs/9.17.2/firebase-auth.js";
            // TODO: Add SDKs for Firebase products that you want to use
            // https://firebase.google.com/docs/web/setup#available-libraries
          
            // Your web app's Firebase configuration
            // For Firebase JS SDK v7.20.0 and later, measurementId is optional
            const firebaseConfig = {
                apiKey: "AIzaSyBf_inD4Hqb2zqkmCuha69YEEgZ0EvSdDI",
            authDomain: "canteen-live-status-65e71.firebaseapp.com",
             databaseURL: "https://canteen-live-status-65e71-default-rtdb.firebaseio.com",
            projectId: "canteen-live-status-65e71",
            storageBucket: "canteen-live-status-65e71.appspot.com",
            messagingSenderId: "427128725985",
            appId: "1:427128725985:web:161d9f41d3e126af35b2a0",
            measurementId: "G-YH01SPNTT2"
            };
          
            // Initialize Firebase
            const app = initializeApp(firebaseConfig);
            const database = getDatabase(app);
            const auth= getAuth();
            const updating_stats = document.getElementById('updating_stats');
            const letsSignOut = document.getElementById('signOut');
            const authform = document.getElementById('field_owner');
            const secretCode = document.getElementById('secretCode');
            const fieldUP = document.getElementById('field');
            const update_status = document.getElementById("update_status");
            const view_status = document.getElementById("view_status");
            const register_hide = document.getElementById('nav_btn2');
            const nav_btn1 = document.getElementById('nav_btn1');                       
   
 
signin_c.addEventListener('click', (e)=>{
    var email__ = document.getElementById('email2').value;
    var Pass__ = document.getElementById('Pass2').value;
   
    signInWithEmailAndPassword(auth, email__, Pass__)
  .then((userCredential) => { 
    // Signed in 
    const user = userCredential.user;
     alert('WeLCOME ' + email__);
     secretCode.style.display= 'block';
     view_status.style.display = 'block';
     
     
         // ...
  })
  .catch((error) => {
    const errorCode = error.code;
    const errorMessage = error.message;
    alert(errorCode + errorMessage);
})}
)

signin.addEventListener('click', (e)=>{
    var email__ = document.getElementById('email').value;
    var Pass__ = document.getElementById('Pass').value;
   
    signInWithEmailAndPassword(auth, email__, Pass__)
  .then((userCredential) => { 
    // Signed in 
    const user = userCredential.user;
     alert('WeLCOME ' + email__);
     secretCode.style.display = 'block';
     authform.style.display = 'none';
     nav_btn1.style.marginLeft = '27.5cm';  
     document.getElementById('reg_update').style.display = 'block';
     document.getElementById('btn_update').style.display = 'block';
     document.getElementById('nav_btn1').style.marginLeft = '25.5cm';

         // ...
  })
  .catch((error) => {
    const errorCode = error.code;
    const errorMessage = error.message;
    alert(errorCode + errorMessage);
})}
)

const dbRef = ref(getDatabase());

function checking() {get(child(dbRef, `users/` + document.getElementById('user_name').value) + "/email").then((snapshot) => {
  if(snapshot.val()==document.getElementById('updating_email').value){
   console.log("correct email id");
  }
  else {
    console.log("No data available");
  }
}).catch((error) => {
  console.error("error_cateen_name_Wala");
});
}
function UpdateData(){
    
    update(ref(database, "users/" + document.getElementById('user_name').value ),{

       status:  document.getElementById('new_status').value,  
    })
    .then(()=>{
        alert("data updated successfully");
        document.getElementById('updating_stats').style.display = 'none';
    })
    .catch((error)=>{
        alert("please try again" + "error :" + errorCode);
    });
}

update_me.addEventListener('click', checking);
update_me.addEventListener('click', UpdateData);



document.getElementById('btn_update').addEventListener('click', (e)=>{
    document.getElementById("btn_update").style.display = 'none';
    document.getElementById("reg_update").style.display = 'none';
    document.getElementById("secretCode").style.display = 'none';
    document.getElementById('updating_stats').style.display= 'block';
    document.getElementById('updating_stats').style.marginTop= '4cm';
  

})

</script>

<div><h1></h1></div>
</body>
</html>